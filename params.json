{"name":"Ridgepole","tagline":"Ridgepole is a tool to manage DB schema.  It defines DB schema using Rails DSL, and updates DB schema according to DSL. (like Chef/Puppet)","body":"**Notice**\r\n\r\n* `>= 0.4.8`\r\n  * `activerecord-mysql-unsigned` is now optional. Please pass `--enable-mysql-unsigned` after you install [activerecord-mysql-unsigned](https://github.com/waka/activerecord-mysql-unsigned) if you want to use.\r\n  * Please pass `--enable-foreigner` after you install [foreigner](https://github.com/matthuhiggins/foreigner) if you want to use the foreign key.\r\n* `>= 0.4.11`\r\n  * Add `--enable-mysql-pkdump` option.\r\n* `>= 0.4.12`\r\n  * Fix `activerecord-mysql-unsigned` version: `~> 0.2.0`\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n    gem 'ridgepole'\r\n\r\nAnd then execute:\r\n\r\n    $ bundle\r\n\r\nOr install it yourself as:\r\n\r\n    $ gem install ridgepole\r\n\r\n## Help\r\n```\r\nUsage: ridgepole [options]\r\n    -c, --config CONF_OR_FILE\r\n    -E, --env ENVIRONMENT\r\n    -a, --apply\r\n    -m, --merge\r\n    -f, --file FILE\r\n        --dry-run\r\n        --table-options OPTIONS\r\n        --bulk-change\r\n        --default-int-limit LIMIT\r\n        --pre-query QUERY\r\n        --post-query QUERY\r\n    -e, --export\r\n        --split\r\n        --split-with-dir\r\n    -d, --diff DSL1 DSL2\r\n        --reverse\r\n        --with-apply\r\n    -o, --output FILE\r\n    -t, --tables TABLES\r\n        --ignore-tables TABLES\r\n        --enable-mysql-unsigned\r\n        --enable-mysql-pkdump\r\n        --enable-foreigner\r\n        --log-file LOG_FILE\r\n        --verbose\r\n        --debug\r\n    -v, --version\r\n```\r\n\r\n## Usage\r\n\r\n```sh\r\n$ git init\r\nInitialized empty Git repository in ...\r\n\r\n$ cat config.yml\r\nadapter: mysql2\r\nencoding: utf8\r\ndatabase: blog\r\nusername: root\r\n\r\n$ ridgepole -c config.yml --export -o Schemafile # or `ridgepole -c '{adapter: mysql2, database: blog}' ...`\r\nExport Schema to `Schemafile`\r\n\r\n$ cat Schemafile\r\ncreate_table \"articles\", force: true do |t|\r\n  t.string   \"title\"\r\n  t.text     \"text\"\r\n  t.datetime \"created_at\"\r\n  t.datetime \"updated_at\"\r\nend\r\n\r\n$ git add .\r\n$ git commit -m 'first commit'  -a\r\n[master (root-commit) a6c2d31] first commit\r\n 2 files changed, 10 insertions(+)\r\n create mode 100644 Schemafile\r\n create mode 100644 config.yml\r\n\r\n$ vi Schemafile\r\n$ git diff\r\ndiff --git a/Schemafile b/Schemafile\r\nindex f5848b9..c266fed 100644\r\n--- a/Schemafile\r\n+++ b/Schemafile\r\n@@ -1,6 +1,7 @@\r\n create_table \"articles\", force: true do |t|\r\n   t.string   \"title\"\r\n   t.text     \"text\"\r\n+  t.text     \"author\"\r\n   t.datetime \"created_at\"\r\n   t.datetime \"updated_at\"\r\n end\r\n\r\n$ ridgepole -c config.yml --apply --dry-run\r\nApply `Schemafile` (dry-run)\r\nadd_column(\"articles\", \"author\", :text, {:after=>\"text\"})\r\n\r\n# ALTER TABLE `articles` ADD `author` text AFTER `text`\r\n\r\n$ ridgepole -c config.yml --apply\r\nApply `Schemafile`\r\n-- add_column(\"articles\", \"author\", :text, {:after=>\"text\"})\r\n   -> 0.0202s\r\n```\r\n\r\n## Rename\r\n```ruby\r\ncreate_table \"articles\", force: true do |t|\r\n  t.string   \"title\"\r\n  t.text     \"desc\", renamed_from: \"text\"\r\n  t.text     \"author\"\r\n  t.datetime \"created_at\"\r\n  t.datetime \"updated_at\"\r\nend\r\n\r\ncreate_table \"user_comments\", force: true, renamed_from: \"comments\" do |t|\r\n  t.string   \"commenter\"\r\n  t.text     \"body\"\r\n  t.integer  \"article_id\"\r\n  t.datetime \"created_at\"\r\n  t.datetime \"updated_at\"\r\nend\r\n```\r\n\r\n## Foreign Key\r\nYou can use the foreign key by passing `--enable-foreigner` ([foreigner](https://github.com/matthuhiggins/foreigner) is required)\r\n\r\n```ruby\r\ncreate_table \"parent\", force: true do |t|\r\nend\r\n\r\ncreate_table \"child\", id: false, force: true do |t|\r\n  t.integer \"id\"\r\n  t.integer \"parent_id\"\r\nend\r\n\r\nadd_index \"child\", [\"parent_id\"], name: \"par_ind\", using: :btree\r\n\r\nadd_foreign_key \"child\", \"parent\", name: \"child_ibfk_1\", dependent: :delete\r\n```\r\n\r\n## bigint support\r\nExport of `bigint` PK is enabled by passing `--enable-mysql-pkdump` ([activerecord-mysql-pkdump](https://github.com/winebarrel/activerecord-mysql-pkdump) is required)\r\n\r\n```ruby\r\ncreate_table \"books\", id: \"bigint(20) PRIMARY KEY auto_increment\", force: true do |t|\r\n  t.string   \"title\",      null: false\r\n  t.integer  \"author_id\",  null: false\r\n  t.datetime \"created_at\"\r\n  t.datetime \"updated_at\"\r\nend\r\n```\r\n\r\n## Execute\r\n```ruby\r\ncreate_table \"authors\", force: true do |t|\r\n  t.string \"name\", null: false\r\nend\r\n\r\ncreate_table \"books\", force: true do |t|\r\n  t.string  \"title\",                     null: false\r\n  t.integer \"author_id\", unsigned: true, null: false\r\nend\r\n\r\nadd_index \"books\", [\"author_id\"], name: \"idx_author_id\", using: :btree\r\n\r\nexecute(\"ALTER TABLE books ADD CONSTRAINT fk_author FOREIGN KEY (author_id) REFERENCES authors (id)\") do |c|\r\n  # Execute SQL only if there is no foreign key\r\n  c.raw_connection.query(\"SELECT 1 FROM information_schema.key_column_usage WHERE TABLE_SCHEMA = 'bookshelf' AND CONSTRAINT_NAME = 'fk_author' LIMIT 1\").each.length.zero?\r\nend\r\n```\r\n\r\n## Diff\r\n```sh\r\n$ ridgepole --diff file1.schema file2.schema\r\nadd_column(\"articles\", \"author\", :text, {:after=>\"title\"})\r\nrename_column(\"articles\", \"text\", \"desc\")\r\n\r\n# You can apply to the database the difference:\r\n# $ ridgepole -c config.yml --diff file1.schema file2.schema --with-apply\r\n```\r\n\r\nYou can also compare databases and files.\r\n\r\n```sh\r\n$ ridgepole --diff config.yml file1.schema\r\nremove_column(\"articles\", \"author\")\r\n```\r\n\r\n### Reverse diff\r\n```sh\r\n$ cat file1.schema\r\ncreate_table \"articles\", force: true do |t|\r\n  t.string   \"title\"\r\n  t.text     \"text\"\r\n  t.datetime \"created_at\"\r\n  t.datetime \"updated_at\"\r\nend\r\n\r\n$ cat file2.schema\r\ncreate_table \"articles\", force: true do |t|\r\n  t.string   \"title\"\r\n  t.text     \"desc\", renamed_from: \"text\"\r\n  t.text     \"author\"\r\n  t.datetime \"created_at\"\r\n  t.datetime \"updated_at\"\r\nend\r\n\r\n$ ridgepole --diff file1.schema file2.schema\r\nadd_column(\"articles\", \"author\", :text, {:after=>\"title\"})\r\nrename_column(\"articles\", \"text\", \"desc\")\r\n\r\n$ ridgepole --diff file1.schema file2.schema --reverse\r\nrename_column(\"articles\", \"desc\", \"text\")\r\nremove_column(\"articles\", \"author\")\r\n```\r\n\r\n## Demo\r\n\r\n* [asciinema.org/a/9349](https://asciinema.org/a/9349)\r\n* [asciinema.org/a/11788](https://asciinema.org/a/11788)\r\n\r\n## Example project\r\n\r\n* https://github.com/winebarrel/ridgepole-example\r\n  * https://github.com/winebarrel/ridgepole-example/pull/1\r\n  * https://github.com/winebarrel/ridgepole-example/pull/2\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}